name: Run tests

on: [push, pull_request]

jobs:
    test:
        services:
            mariadb:
                image: mariadb
                ports:
                    - 3306:3306
                env:
                    MYSQL_ROOT_PASSWORD: root
        runs-on: ubuntu-latest
        steps:
            - name: Verify MySQL connection from host
              run: |
                  sudo apt-get install -y mysql-client
                  mysql --host 127.0.0.1 --port 3306 -uroot -proot -e "SHOW DATABASES"

            - uses: actions/checkout@v1

            - uses: actions/cache@v1
              id: cache-composer
              with:
                  path: ~/.composer/cache
                  key: ${{ runner.os }}-composer

            - uses: actions/cache@v1
              id: cache-wp-cli
              with:
                  path: ~/.wp-cli/cache
                  key: ${{ runner.os }}-wp-cli

            - name: Run tests
              run: .github/run-tests
